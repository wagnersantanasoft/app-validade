<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>Controle de Validade de Produtos</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="app">

    <!-- ================= LOGIN ================= -->
    <section id="login-view" class="view active">
      <div class="card login-card">
        <h1>Controle de Validade</h1>
        <form id="login-form">
          <label>
            Usu√°rio
            <input type="text" id="username" autocomplete="username" placeholder="admin" required  />
          </label>
          <label>
            Senha
            <input type="password" id="password" autocomplete="current-password" placeholder="admin123" required />
          </label>
          <button type="submit" class="btn primary full">Entrar</button>
          <p id="login-error" class="error-msg" hidden></p>
        </form>
      </div>
    </section>

    <!-- ================= DASHBOARD ================= -->
    <section id="dashboard-view" class="view">
      <header class="topbar">
        <div class="brand">
          <strong>Controle de Validade</strong>
          <span id="user-badge"></span>
        </div>
        <div class="topbar-actions">
          <button id="toggle-view" class="btn small" title="Alternar visualiza√ß√£o (Tabela / Cart√µes)">üóÇ</button>
          <button id="scan-btn" class="btn small" title="Ler c√≥digo de barras e filtrar produto">üîç Ler C√≥digo</button>
          <button id="theme-toggle" class="btn small" title="Alternar tema claro/escuro">üåì</button>
          <button id="add-product-btn" class="btn small primary" title="Adicionar produto">Ôºã Produto</button>
          <button id="refresh-btn" class="btn small" title="Recarregar produtos">‚Ü≥ Atualizar</button>
          <button id="logout-btn" class="btn small danger" title="Encerrar sess√£o">Sair</button>
        </div>
      </header>

      <main class="content">
        <section class="filters">
          <div class="filter-group">
            <label>
              Grupo
              <select id="group-filter">
                <option value="">Todos</option>
              </select>
            </label>
            <label>
              Marca
              <select id="brand-filter">
                <option value="">Todas</option>
              </select>
            </label>
            <label>
              Buscar (nome, c√≥digo ou c√≥d. barras)
              <input type="text" id="search-filter" placeholder="Ex: leite, L001, 789..." />
            </label>
            <label>
              Dias p/ considerar 'Pr√≥ximo de Vencer'
              <input type="number" id="threshold-days" min="1" value="15" />
            </label>
            <label class="inline-checkbox">
              <input type="checkbox" id="show-removed" />
              Mostrar removidos
            </label>
          </div>

          <div class="segmented">
            <button data-status="all" class="seg-btn active">Todos</button>
            <button data-status="near" class="seg-btn">Pr√≥ximo de Vencer</button>
            <button data-status="expired" class="seg-btn">Vencidos</button>
          </div>
        </section>

        <!-- Table View -->
        <section class="table-wrapper" id="table-view">
          <table id="products-table">
            <thead>
              <tr>
                <th>C√≥digo</th>
                <th>C√≥d. Barras</th>
                <th>Produto</th>
                <th>Grupo</th>
                <th>Marca</th>
                <th>Validade</th>
                <th>Dias Rest.</th>
                <th>Status</th>
                <th>A√ß√£o</th>
              </tr>
            </thead>
            <tbody id="products-tbody">
              <tr><td colspan="9" class="center muted">Carregando...</td></tr>
            </tbody>
          </table>
        </section>

        <!-- Card View -->
        <section id="cards-view" class="cards-view hidden">
          <div id="cards-container" class="cards-grid"></div>
        </section>
      </main>

      <footer class="footer">
        <small>Santanasoft</small>
      </footer>
    </section>
  </div>

  <!-- Modal de Produto (inclus√£o/edi√ß√£o) -->
  <div id="product-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-inner">
      <div class="modal-header">
        <strong id="modal-title">Novo Produto</strong>
        <button id="close-modal" class="btn small danger">‚úï</button>
      </div>
      <form id="product-form">
        <div class="form-grid">
          <label>
            C√≥digo
            <input id="p-code" name="code" required placeholder="Ex: L001" />
          </label>
          <label>
            C√≥d. Barras
            <input id="p-barcode" name="barcode" placeholder="Ex: 789..." />
          </label>
          <label class="full">
            Nome do Produto
            <input id="p-name" name="name" required placeholder="Ex: Leite Integral 1L" />
          </label>
          <label>
            Grupo
            <input id="p-group" name="group" required placeholder="Ex: Latic√≠nios" />
          </label>
          <label>
            Marca
            <input id="p-brand" name="brand" required placeholder="Ex: Fazenda Boa" />
          </label>
          <label>
            Validade
            <input type="date" id="p-expiry" name="expiryDate" required />
          </label>
          <label>
            Pre√ßo
            <input type="number" id="p-price" name="price" inputmode="decimal" step="0.01" min="0" placeholder="Ex: 12,50" />
          </label>
          <label>
            Unidade de medida
            <input id="p-unit" name="unit" placeholder="Ex: L, kg, un" />
          </label>
        </div>
        <p id="product-error" class="error-msg" hidden></p>
        <div class="modal-actions">
          <button type="button" id="cancel-modal" class="btn">Cancelar</button>
          <button type="submit" class="btn primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scanner Overlay (adaptado para Quagga2 com video direto) -->
  <div id="scanner-overlay" class="modal hidden" role="dialog" aria-modal="true" style="background:rgba(0,0,0,.85);">
    <div class="modal-inner" style="max-width:520px;">
      <div class="modal-header">
        <strong>Leitura de C√≥digo de Barras</strong>
        <button id="close-scanner" class="btn small danger">‚úï</button>
      </div>

      <video id="scanner-video" autoplay playsinline style="width:100%;aspect-ratio:4/3;background:#000;border:1px solid var(--c-border);border-radius:var(--radius);object-fit:cover;"></video>

      <p id="scanner-status" class="muted" style="font-size:.7rem;margin:.6rem 0 0;">
        Preparando c√¢mera...
      </p>

      <div style="margin-top:.6rem;display:flex;gap:.5rem;flex-wrap:wrap;">
        <input id="manual-barcode" placeholder="(Opcional) Digite/cole c√≥digo" style="flex:1;padding:.55rem .6rem;font-size:.75rem;border:1px solid var(--c-border);border-radius:6px;background:var(--c-bg-soft);color:var(--c-text);" />
        <button id="apply-barcode" class="btn small primary">Usar C√≥digo</button>
      </div>
      <small class="muted" style="display:block;margin-top:.5rem;line-height:1.3;">
        Aponte a c√¢mera para o c√≥digo de barras. Ao detectar, a busca ser√° preenchida automaticamente.
      </small>
    </div>
  </div>

  <template id="row-template">
    <tr>
      <td class="col-code"></td>
      <td class="col-barcode"></td>
      <td class="col-name"></td>
      <td class="col-group"></td>
      <td class="col-brand"></td>
      <td class="col-expiry"></td>
      <td class="col-days"></td>
      <td class="col-status badge-cell"></td>
      <td class="col-action"></td>
    </tr>
  </template>

  <template id="card-template">
    <div class="product-card">
      <div class="pc-head">
        <span class="pc-code"></span>
        <span class="pc-status"></span>
      </div>
      <h4 class="pc-name"></h4>
      <dl class="pc-info">
        <div><dt>Grupo:</dt><dd class="pc-group"></dd></div>
        <div><dt>Marca:</dt><dd class="pc-brand"></dd></div>
        <div><dt>Barras:</dt><dd class="pc-barcode"></dd></div>
        <div><dt>Validade:</dt><dd class="pc-expiry"></dd></div>
        <div><dt>Dias:</dt><dd class="pc-days"></dd></div>
        <div><dt>Pre√ßo:</dt><dd class="pc-price"></dd></div>
        <div><dt>Unid.:</dt><dd class="pc-unit"></dd></div>
      </dl>
      <div class="pc-actions"></div>
    </div>
  </template>

  <!-- Quagga2 (mesma lib do seu exemplo) -->
  <script src="https://unpkg.com/@ericblade/quagga2@1.2.6/dist/quagga.min.js"></script>

  <script type="module" src="js/theme.js"></script>
  <script type="module" src="js/scanner.js"></script>
  <script type="module" src="js/app.js"></script>
</body>
</html>